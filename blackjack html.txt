<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Blackjack (21)</title>
  <style>
    :root{
      --bg:#0b1020; --panel:#121a33; --panel2:#0f1730; --text:#e9eeff; --muted:#a8b3dd;
      --good:#3ddc97; --bad:#ff6b6b; --warn:#ffd166; --line:rgba(255,255,255,.08);
      --btn:#1e2b57; --btn2:#2b3b78; --focus:#77a6ff;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:radial-gradient(1200px 700px at 30% 0%, #162255 0%, var(--bg) 55%);
      color:var(--text);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:24px}
    header{display:flex; align-items:flex-start; justify-content:space-between; gap:16px; margin-bottom:16px}
    h1{margin:0; font-size:28px; letter-spacing:.3px}
    .sub{color:var(--muted); margin-top:6px; font-size:14px; line-height:1.3}
    .grid{display:grid; grid-template-columns: 1.1fr .9fr; gap:16px}
    @media (max-width: 920px){ .grid{grid-template-columns:1fr} }

    .panel{
      background:linear-gradient(180deg, var(--panel), var(--panel2));
      border:1px solid var(--line);
      border-radius:16px;
      padding:16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
    .stat{
      background:rgba(255,255,255,.04);
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px 12px;
      display:flex; gap:8px; align-items:baseline;
      min-width:160px;
    }
    .stat b{font-size:18px}
    .stat span{color:var(--muted); font-size:12px}

    .table{display:grid; grid-template-rows:auto auto; gap:14px}
    .handBox{
      border:1px solid var(--line);
      border-radius:14px;
      padding:14px;
      background:rgba(255,255,255,.03);
    }
    .handHead{
      display:flex; justify-content:space-between; gap:12px; align-items:flex-start; flex-wrap:wrap;
      margin-bottom:10px;
    }
    .who{font-weight:700}
    .meta{color:var(--muted); font-size:13px}
    .cards{display:flex; gap:10px; flex-wrap:wrap; min-height:62px}
    .card{
      width:56px; height:78px; border-radius:12px;
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.03));
      border:1px solid var(--line);
      display:flex; flex-direction:column; justify-content:space-between;
      padding:8px 9px;
      box-shadow: 0 6px 18px rgba(0,0,0,.25);
    }
    .rank{font-weight:800; font-size:16px}
    .suit{font-size:18px; opacity:.95}
    .red{color:#ff7a7a}
    .black{color:#d9e2ff}
    .facedown{
      background:linear-gradient(135deg, rgba(119,166,255,.25), rgba(30,43,87,.85));
      position:relative;
      overflow:hidden;
    }
    .facedown:before{
      content:"";
      position:absolute; inset:-30px;
      background:repeating-linear-gradient(45deg, rgba(255,255,255,.16) 0 6px, rgba(255,255,255,0) 6px 14px);
      opacity:.35;
    }
    .facedown .rank, .facedown .suit{visibility:hidden}

    .controls{display:flex; flex-direction:column; gap:12px}
    .controls .panel{padding:14px}
    .btns{display:flex; gap:10px; flex-wrap:wrap}
    button{
      appearance:none; border:1px solid var(--line);
      background:linear-gradient(180deg, var(--btn2), var(--btn));
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:650;
      letter-spacing:.2px;
      transition: transform .05s ease, filter .15s ease, opacity .15s ease;
      min-width:120px;
    }
    button:hover{filter:brightness(1.05)}
    button:active{transform:translateY(1px)}
    button:disabled{opacity:.45; cursor:not-allowed}
    button:focus{outline:2px solid var(--focus); outline-offset:2px}

    .betRow{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    input[type="number"]{
      width:160px; padding:10px 12px; border-radius:12px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.22);
      color:var(--text);
      font-size:14px;
    }
    .msg{
      border:1px dashed var(--line);
      background:rgba(255,255,255,.03);
      border-radius:14px;
      padding:12px;
      line-height:1.35;
      color:var(--text);
    }
    .msg small{color:var(--muted)}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:5px 10px; border-radius:999px; font-size:12px;
      border:1px solid var(--line); background:rgba(255,255,255,.04);
      color:var(--muted);
    }
    .good{color:var(--good)}
    .bad{color:var(--bad)}
    .warn{color:var(--warn)}
    .handTabs{display:flex; gap:8px; flex-wrap:wrap}
    .tab{
      min-width:auto;
      padding:7px 10px;
      border-radius:999px;
      font-size:12px;
      background:rgba(255,255,255,.04);
    }
    .tab.active{
      border-color:rgba(119,166,255,.6);
      box-shadow:0 0 0 2px rgba(119,166,255,.18) inset;
    }
    footer{margin-top:14px; color:var(--muted); font-size:12px}
    code.inline{background:rgba(255,255,255,.06); padding:1px 6px; border-radius:8px; border:1px solid var(--line)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Blackjack (21)</h1>
        <div class="sub">
          Dealer stands on soft 17 • Blackjack pays 3:2 • Split pairs • Double down
          <div style="margin-top:8px" class="pill" id="shoePill">Shoe: —</div>
        </div>
      </div>
      <div class="row">
        <div class="stat"><span>Bankroll</span><b id="bankroll">$1000</b></div>
        <div class="stat"><span>Current Bet</span><b id="totalBet">$0</b></div>
        <div class="stat"><span>Round</span><b id="roundNo">1</b></div>
      </div>
    </header>

    <div class="grid">
      <section class="panel table" aria-label="Blackjack table">
        <div class="handBox" id="dealerBox">
          <div class="handHead">
            <div>
              <div class="who">Dealer</div>
              <div class="meta" id="dealerMeta">—</div>
            </div>
            <div class="meta" id="dealerValue">Value: —</div>
          </div>
          <div class="cards" id="dealerCards"></div>
        </div>

        <div class="handBox" id="playerBox">
          <div class="handHead">
            <div>
              <div class="who">Player</div>
              <div class="meta" id="playerMeta">—</div>
              <div class="handTabs" id="handTabs" aria-label="Hands"></div>
            </div>
            <div class="meta" id="playerValue">Value: —</div>
          </div>
          <div class="cards" id="playerCards"></div>
        </div>
      </section>

      <aside class="controls">
        <div class="panel">
          <div class="betRow">
            <label for="betInput" class="pill">Bet</label>
            <input id="betInput" type="number" min="1" step="1" value="50" />
            <button id="btnDeal">Deal</button>
            <button id="btnReset" title="Reset bankroll + reshuffle">Reset</button>
          </div>
          <div style="margin-top:10px" class="btns">
            <button id="btnHit" disabled>Hit</button>
            <button id="btnStand" disabled>Stand</button>
            <button id="btnDouble" disabled>Double</button>
            <button id="btnSplit" disabled>Split</button>
            <button id="btnNext" disabled>Next Round</button>
          </div>
        </div>

        <div class="panel msg" id="message" role="status" aria-live="polite">
          Place a bet and press <b>Deal</b>.
          <div><small>Tip: You can double or split only on your first decision for that hand.</small></div>
        </div>

        <div class="panel">
          <div class="pill">Rules (this build)</div>
          <ul style="margin:10px 0 0 18px; padding:0; color:var(--muted); line-height:1.5">
            <li>Aces count as 1 or 11.</li>
            <li>Dealer stands on all 17s (including soft 17).</li>
            <li>Blackjack (A + 10-value) pays 3:2 unless dealer also has blackjack (push).</li>
            <li>Double: one card only, then stand.</li>
            <li>Split: only when first two cards are same rank; creates 2 hands.</li>
          </ul>
        </div>

        <footer>
          Built as a static site. Deploy it to GitHub Pages / Netlify / Vercel to get a shareable link. :contentReference[oaicite:1]{index=1}
        </footer>
      </aside>
    </div>
  </div>

<script>
(() => {
  // ---- Config ----
  const CONFIG = {
    decks: 6,
    reshuffleAt: 0.22, // reshuffle when shoe below 22%
    blackjackPayout: 1.5, // 3:2
    dealerStandsOnSoft17: true
  };

  // ---- Card helpers ----
  const SUITS = [
    {s:"♠", c:"black"},
    {s:"♥", c:"red"},
    {s:"♦", c:"red"},
    {s:"♣", c:"black"},
  ];
  const RANKS = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];

  function newShoe(decks){
    const shoe = [];
    for(let d=0; d<decks; d++){
      for(const suit of SUITS){
        for(const r of RANKS){
          shoe.push({ r, suit: suit.s, color: suit.c });
        }
      }
    }
    shuffle(shoe);
    return shoe;
  }

  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]] = [arr[j],arr[i]];
    }
  }

  function cardValueRank(r){
    if(r === "A") return 11;
    if(r === "K" || r === "Q" || r === "J") return 10;
    return Number(r);
  }

  function handValue(cards){
    // returns {total, soft, acesAsEleven}
    let total = 0;
    let aces = 0;
    for(const c of cards){
      total += cardValueRank(c.r);
      if(c.r === "A") aces++;
    }
    // downgrade aces from 11 to 1 as needed
    let acesAsEleven = aces;
    while(total > 21 && acesAsEleven > 0){
      total -= 10;
      acesAsEleven--;
    }
    const soft = (acesAsEleven > 0); // at least one ace counted as 11
    return { total, soft, acesAsEleven };
  }

  function isBlackjack(cards){
    if(cards.length !== 2) return false;
    const v = handValue(cards).total;
    return v === 21;
  }

  function canSplit(cards){
    return cards.length === 2 && cards[0].r === cards[1].r;
  }

  // ---- UI ----
  const $ = (id) => document.getElementById(id);
  const dealerCardsEl = $("dealerCards");
  const playerCardsEl = $("playerCards");
  const dealerMetaEl = $("dealerMeta");
  const playerMetaEl = $("playerMeta");
  const dealerValueEl = $("dealerValue");
  const playerValueEl = $("playerValue");
  const messageEl = $("message");
  const bankrollEl = $("bankroll");
  const totalBetEl = $("totalBet");
  const roundNoEl = $("roundNo");
  const shoePillEl = $("shoePill");

  const betInput = $("betInput");
  const btnDeal = $("btnDeal");
  const btnReset = $("btnReset");
  const btnHit = $("btnHit");
  const btnStand = $("btnStand");
  const btnDouble = $("btnDouble");
  const btnSplit = $("btnSplit");
  const btnNext = $("btnNext");
  const handTabsEl = $("handTabs");

  function setMsg(html){ messageEl.innerHTML = html; }

  function renderCard(c, facedown=false){
    const div = document.createElement("div");
    div.className = "card " + (facedown ? "facedown" : "");
    const r = document.createElement("div");
    r.className = "rank";
    r.textContent = c.r;
    const s = document.createElement("div");
    s.className = "suit " + (c.color === "red" ? "red":"black");
    s.textContent = c.suit;
    div.appendChild(r);
    div.appendChild(s);
    return div;
  }

  function renderCards(el, cards, hideFirst=false){
    el.innerHTML = "";
    cards.forEach((c, idx) => {
      el.appendChild(renderCard(c, hideFirst && idx===0));
    });
  }

  function money(n){
    return "$" + n.toLocaleString(undefined, {maximumFractionDigits:0});
  }

  // ---- Game state ----
  const state = {
    bankroll: 1000,
    round: 1,
    shoe: newShoe(CONFIG.decks),

    phase: "betting", // betting | player | dealer | roundOver
    dealer: [],
    hands: [], // each: {cards:[], bet:number, done:boolean, doubled:boolean, firstAction:boolean, result:null}
    activeHand: 0,
    dealerHoleHidden: true
  };

  function shoeInfo(){
    const total = 52 * CONFIG.decks;
    const left = state.shoe.length;
    const pct = Math.round((left/total)*100);
    shoePillEl.textContent = `Shoe: ${left}/${total} (${pct}%)`;
    // auto-reshuffle if low
    if(left/total < CONFIG.reshuffleAt){
      state.shoe = newShoe(CONFIG.decks);
      shoePillEl.textContent = `Shoe: reshuffled (${52*CONFIG.decks})`;
      setMsg(`<b class="warn">Reshuffled</b> the shoe (was running low).`);
    }
  }

  function draw(){
    if(state.shoe.length === 0) state.shoe = newShoe(CONFIG.decks);
    return state.shoe.pop();
  }

  function updateTopStats(){
    bankrollEl.textContent = money(state.bankroll);
    roundNoEl.textContent = String(state.round);
    const totalBet = state.hands.reduce((s,h)=>s+h.bet, 0);
    totalBetEl.textContent = money(totalBet);
    shoeInfo();
  }

  function renderHands(){
    // dealer
    renderCards(dealerCardsEl, state.dealer, state.dealerHoleHidden && state.phase !== "dealer" && state.phase !== "roundOver");
    const dealerShown = (state.dealerHoleHidden && state.dealer.length>0 && (state.phase==="player" || state.phase==="betting"))
      ? [state.dealer[1]].filter(Boolean)
      : state.dealer;

    if(dealerShown.length === 0){
      dealerValueEl.textContent = "Value: —";
      dealerMetaEl.textContent = "Waiting…";
    } else {
      const dv = handValue(dealerShown).total;
      dealerValueEl.textContent = `Value: ${dv}${(state.dealerHoleHidden && (state.phase==="player"||state.phase==="betting")) ? " (showing)" : ""}`;
      dealerMetaEl.textContent = (state.dealerHoleHidden && (state.phase==="player"||state.phase==="betting")) ? "Hole card hidden" : "Dealer plays on 16, stands on 17 (incl. soft 17)";
    }

    // player active hand cards
    const h = state.hands[state.activeHand];
    if(!h){
      playerCardsEl.innerHTML = "";
      playerValueEl.textContent = "Value: —";
      playerMetaEl.textContent = "Waiting…";
      handTabsEl.innerHTML = "";
      return;
    }
    renderCards(playerCardsEl, h.cards, false);

    const hv = handValue(h.cards);
    playerValueEl.textContent = `Value: ${hv.total}${hv.soft ? " (soft)" : ""}`;
    playerMetaEl.textContent = `Hand ${state.activeHand+1} of ${state.hands.length} • Bet ${money(h.bet)}${h.doubled ? " • Doubled" : ""}`;

    // tabs
    handTabsEl.innerHTML = "";
    if(state.hands.length > 1){
      state.hands.forEach((hand, idx) => {
        const b = document.createElement("button");
        b.className = "tab" + (idx===state.activeHand ? " active" : "");
        const v = handValue(hand.cards).total;
        b.textContent = `Hand ${idx+1} (${v})`;
        b.onclick = () => {
          if(state.phase === "player"){
            state.activeHand = idx;
            renderHands();
            updateButtons();
          }
        };
        handTabsEl.appendChild(b);
      });
    }
  }

  function updateButtons(){
    const phase = state.phase;
    const h = state.hands[state.activeHand];

    const inPlayer = phase === "player";
    btnHit.disabled = !inPlayer || !h || h.done;
    btnStand.disabled = !inPlayer || !h || h.done;

    // double/split only on firstAction of that hand
    const canDouble = inPlayer && h && !h.done && h.firstAction && state.bankroll >= h.bet;
    btnDouble.disabled = !canDouble;

    const canSplitNow = inPlayer && h && !h.done && h.firstAction && canSplit(h.cards) && state.bankroll >= h.bet && state.hands.length < 4;
    btnSplit.disabled = !canSplitNow;

    btnDeal.disabled = phase !== "betting";
    btnNext.disabled = phase !== "roundOver";
    betInput.disabled = phase !== "betting";
  }

  function startBetting(){
    state.phase = "betting";
    state.dealer = [];
    state.hands = [];
    state.activeHand = 0;
    state.dealerHoleHidden = true;
    updateTopStats();
    renderHands();
    updateButtons();
  }

  function newRound(){
    // validate bet
    const bet = Math.floor(Number(betInput.value));
    if(!Number.isFinite(bet) || bet <= 0){
      setMsg(`<b class="bad">Invalid bet.</b> Enter a positive whole number.`);
      return;
    }
    if(bet > state.bankroll){
      setMsg(`<b class="bad">Not enough bankroll.</b> Your bankroll is ${money(state.bankroll)}.`);
      return;
    }

    state.phase = "player";
    state.dealer = [draw(), draw()];
    state.dealerHoleHidden = true;

    state.hands = [{
      cards: [draw(), draw()],
      bet,
      done:false,
      doubled:false,
      firstAction:true,
      result:null,
      payout:0
    }];
    state.activeHand = 0;

    // take bet from bankroll up-front (per-hand)
    state.bankroll -= bet;

    updateTopStats();
    renderHands();

    // check immediate blackjacks
    const playerBJ = isBlackjack(state.hands[0].cards);
    const dealerBJ = isBlackjack(state.dealer);

    if(playerBJ || dealerBJ){
      state.dealerHoleHidden = false;
      settleNaturals(playerBJ, dealerBJ);
      return;
    }

    setMsg(`Your move. <b>Hit</b>, <b>Stand</b>, <b>Double</b>, or <b>Split</b> (if available).`);
    updateButtons();
  }

  function settleNaturals(playerBJ, dealerBJ){
    // only one hand exists here (no split before checks)
    const h = state.hands[0];
    state.phase = "roundOver";

    if(playerBJ && dealerBJ){
      // push: return bet
      h.result = "push";
      state.bankroll += h.bet;
      setMsg(`<b>Push.</b> Both you and dealer have Blackjack. Bet returned.`);
    } else if(playerBJ){
      h.result = "blackjack";
      const win = Math.floor(h.bet * CONFIG.blackjackPayout);
      state.bankroll += h.bet + win;
      setMsg(`<b class="good">Blackjack!</b> You win ${money(win)} (pays 3:2).`);
    } else {
      h.result = "lose";
      setMsg(`<b class="bad">Dealer Blackjack.</b> You lose ${money(h.bet)}.`);
    }

    endRoundUI();
  }

  function currentHand(){
    return state.hands[state.activeHand];
  }

  function hit(){
    const h = currentHand();
    if(!h || h.done) return;
    h.cards.push(draw());
    h.firstAction = false;

    renderHands();

    const v = handValue(h.cards).total;
    if(v > 21){
      h.done = true;
      h.result = "bust";
      setMsg(`<b class="bad">Bust.</b> Hand ${state.activeHand+1} is over.`);
      advanceOrDealer();
    } else {
      setMsg(`Hit or stand?`);
      updateButtons();
    }
  }

  function stand(){
    const h = currentHand();
    if(!h || h.done) return;
    h.done = true;
    h.firstAction = false;
    setMsg(`Standing on Hand ${state.activeHand+1}.`);
    advanceOrDealer();
  }

  function doubleDown(){
    const h = currentHand();
    if(!h || h.done || !h.firstAction) return;
    if(state.bankroll < h.bet){
      setMsg(`<b class="bad">Not enough bankroll</b> to double.`);
      return;
    }
    // take additional bet
    state.bankroll -= h.bet;
    h.bet *= 2;
    h.doubled = true;
    h.firstAction = false;

    h.cards.push(draw());
    renderHands();
    updateTopStats();

    const v = handValue(h.cards).total;
    h.done = true;
    if(v > 21){
      h.result = "bust";
      setMsg(`<b class="bad">Double bust.</b> Hand ${state.activeHand+1} is over.`);
    } else {
      setMsg(`Doubled. You drew one card and must stand.`);
    }
    advanceOrDealer();
  }

  function splitHand(){
    const h = currentHand();
    if(!h || h.done || !h.firstAction) return;
    if(!canSplit(h.cards)){
      setMsg(`<b class="bad">Can't split</b> this hand.`);
      return;
    }
    if(state.bankroll < h.bet){
      setMsg(`<b class="bad">Not enough bankroll</b> to split.`);
      return;
    }
    // take additional bet for the new hand
    state.bankroll -= h.bet;

    const c1 = h.cards[0];
    const c2 = h.cards[1];

    // create two hands, each gets one additional card
    const handA = {
      cards: [c1, draw()],
      bet: h.bet,
      done:false,
      doubled:false,
      firstAction:true,
      result:null,
      payout:0
    };
    const handB = {
      cards: [c2, draw()],
      bet: h.bet,
      done:false,
      doubled:false,
      firstAction:true,
      result:null,
      payout:0
    };

    // replace current hand with handA, insert handB after it
    state.hands.splice(state.activeHand, 1, handA, handB);

    // stay on first split hand
    state.activeHand = state.activeHand;
    setMsg(`Split! Playing Hand ${state.activeHand+1} first.`);
    updateTopStats();
    renderHands();
    updateButtons();
  }

  function advanceOrDealer(){
    // move to next unfinished hand if any
    let next = state.hands.findIndex((h, idx) => idx > state.activeHand && !h.done);
    if(next === -1){
      next = state.hands.findIndex((h) => !h.done);
    }

    if(next !== -1){
      state.activeHand = next;
      renderHands();
      updateButtons();
      setMsg(`Now playing Hand ${state.activeHand+1}.`);
      return;
    }

    // all hands done -> dealer turn if any hand not busted
    const anyLive = state.hands.some(h => handValue(h.cards).total <= 21);
    if(!anyLive){
      state.phase = "roundOver";
      state.dealerHoleHidden = false;
      setMsg(`<b class="bad">All hands busted.</b> Dealer doesn't need to draw.`);
      endRoundUI();
      return;
    }

    dealerTurn();
  }

  function dealerTurn(){
    state.phase = "dealer";
    state.dealerHoleHidden = false;
    renderHands();
    updateButtons();

    // Dealer draws until 17+, stands on soft 17 as configured
    while(true){
      const hv = handValue(state.dealer);
      const total = hv.total;

      if(total < 17){
        state.dealer.push(draw());
        continue;
      }
      if(total === 17 && hv.soft && !CONFIG.dealerStandsOnSoft17){
        state.dealer.push(draw());
        continue;
      }
      break;
    }

    renderHands();
    settleHands();
  }

  function settleHands(){
    const dealerTotal = handValue(state.dealer).total;
    const dealerBust = dealerTotal > 21;

    let summary = [];
    let net = 0;

    state.hands.forEach((h, idx) => {
      const pt = handValue(h.cards).total;

      // if already busted
      if(pt > 21){
        h.result = "lose";
        summary.push(`Hand ${idx+1}: <b class="bad">Lose</b> (bust)`);
        net -= h.bet;
        return;
      }

      if(dealerBust){
        h.result = "win";
        // pay 1:1
        state.bankroll += h.bet * 2;
        summary.push(`Hand ${idx+1}: <b class="good">Win</b> (dealer bust) +${money(h.bet)}`);
        net += h.bet;
        return;
      }

      if(pt > dealerTotal){
        h.result = "win";
        state.bankroll += h.bet * 2;
        summary.push(`Hand ${idx+1}: <b class="good">Win</b> +${money(h.bet)} (${pt} vs ${dealerTotal})`);
        net += h.bet;
      } else if(pt < dealerTotal){
        h.result = "lose";
        summary.push(`Hand ${idx+1}: <b class="bad">Lose</b> -${money(h.bet)} (${pt} vs ${dealerTotal})`);
        net -= h.bet;
      } else {
        h.result = "push";
        state.bankroll += h.bet;
        summary.push(`Hand ${idx+1}: <b>Push</b> (tie at ${pt})`);
      }
    });

    state.phase = "roundOver";
    updateTopStats();

    const netLine =
      net > 0 ? `<div style="margin-top:8px"><b class="good">Net: +${money(net)}</b></div>` :
      net < 0 ? `<div style="margin-top:8px"><b class="bad">Net: -${money(Math.abs(net))}</b></div>` :
                `<div style="margin-top:8px"><b>Net: $0</b></div>`;

    setMsg(`<b>Round complete.</b><div style="margin-top:8px; color:var(--muted)">${summary.join("<br>")}</div>${netLine}`);
    endRoundUI();
  }

  function endRoundUI(){
    updateTopStats();
    renderHands();
    updateButtons();
    btnNext.disabled = false;

    // bankroll bust protection
    if(state.bankroll <= 0){
      setMsg(`<b class="bad">You're out of bankroll.</b> Press <b>Reset</b> to start over.`);
      btnDeal.disabled = true;
      betInput.disabled = true;
    }
  }

  function nextRound(){
    state.round += 1;
    startBetting();
    setMsg(`Place a bet and press <b>Deal</b>.`);
  }

  function resetAll(){
    state.bankroll = 1000;
    state.round = 1;
    state.shoe = newShoe(CONFIG.decks);
    startBetting();
    betInput.value = 50;
    setMsg(`Reset complete. Place a bet and press <b>Deal</b>.`);
  }

  // ---- Wire up buttons ----
  btnDeal.addEventListener("click", newRound);
  btnHit.addEventListener("click", hit);
  btnStand.addEventListener("click", stand);
  btnDouble.addEventListener("click", doubleDown);
  btnSplit.addEventListener("click", splitHand);
  btnNext.addEventListener("click", nextRound);
  btnReset.addEventListener("click", resetAll);

  // keyboard shortcuts
  document.addEventListener("keydown", (e) => {
    if(e.target && (e.target.tagName === "INPUT" || e.target.tagName === "TEXTAREA")) return;
    if(e.key.toLowerCase() === "h" && !btnHit.disabled) hit();
    if(e.key.toLowerCase() === "s" && !btnStand.disabled) stand();
    if(e.key.toLowerCase() === "d" && !btnDouble.disabled) doubleDown();
    if(e.key.toLowerCase() === "p" && !btnSplit.disabled) splitHand();
    if(e.key.toLowerCase() === "n" && !btnNext.disabled) nextRound();
  });

  // init
  startBetting();
})();
</script>
</body>
</html>
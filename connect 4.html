<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Connect 4</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#121a33;
      --text:#e7ecff;
      --muted:#aab3d6;
      --blue:#2a60ff;
      --yellow:#ffd24a;
      --red:#ff4a6b;
      --grid:#1b2550;
      --hole:#0a0f25;
      --shadow: 0 12px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      background: radial-gradient(1200px 600px at 20% 10%, #1a2a7a33, transparent 60%),
                  radial-gradient(1000px 700px at 80% 90%, #ff4a6b22, transparent 55%),
                  var(--bg);
      color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    .app{
      width:min(980px, 94vw);
      display:grid;
      grid-template-columns: 1fr;
      gap:16px;
      padding:18px;
    }
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    h1{
      margin:0;
      font-size:clamp(22px, 3vw, 30px);
      letter-spacing:.2px;
    }
    .sub{
      color:var(--muted);
      font-size:14px;
      margin-top:2px;
    }
    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    button{
      appearance:none;
      border:1px solid #2b3a77;
      background: linear-gradient(180deg, #192352, #121a33);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      box-shadow: 0 8px 18px rgba(0,0,0,.25);
      font-weight:650;
      letter-spacing:.2px;
    }
    button:hover{filter:brightness(1.08)}
    button:active{transform: translateY(1px)}
    .toggle{
      display:flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid #2b3a77;
      background: linear-gradient(180deg, #192352, #121a33);
      box-shadow: 0 8px 18px rgba(0,0,0,.25);
      user-select:none;
    }
    .toggle input{transform: scale(1.15)}

    .main{
      display:grid;
      grid-template-columns: 1fr 320px;
      gap:16px;
      align-items:start;
    }
    @media (max-width: 900px){
      .main{grid-template-columns: 1fr;}
    }

    .board-wrap{
      background: linear-gradient(180deg, #0f1738, #0b1020);
      border: 1px solid #22306a;
      border-radius:18px;
      box-shadow: var(--shadow);
      padding:14px;
      position:relative;
      overflow:hidden;
    }

    .drop-row{
      display:grid;
      grid-template-columns: repeat(7, 1fr);
      gap:10px;
      margin-bottom:12px;
    }
    .drop{
      height:44px;
      border-radius:14px;
      border:1px dashed #2b3a77;
      background: #101841aa;
      cursor:pointer;
      position:relative;
      transition: .15s ease;
    }
    .drop:hover{background:#15205aaa; border-style:solid}
    .drop:disabled{opacity:.45; cursor:not-allowed}
    .preview{
      position:absolute;
      inset: 6px;
      border-radius:999px;
      background: transparent;
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.08);
      transform: translateY(-2px);
      opacity:0;
      transition:.12s ease;
    }
    .drop:hover .preview{opacity:1}

    .grid{
      display:grid;
      grid-template-columns: repeat(7, 1fr);
      gap:10px;
      padding:14px;
      border-radius:16px;
      background: linear-gradient(180deg, #1b2b75, #15205a);
      border: 1px solid #2a3a86;
      position:relative;
    }

    .cell{
      width:100%;
      aspect-ratio: 1 / 1;
      border-radius:999px;
      background: radial-gradient(circle at 35% 30%, #11183d, var(--hole) 65%);
      border:1px solid rgba(255,255,255,.08);
      position:relative;
      overflow:hidden;
    }

    .disc{
      position:absolute;
      inset:6px;
      border-radius:999px;
      transform: translateY(-120%);
      animation: drop .18s ease-out forwards;
      box-shadow: inset 0 10px 14px rgba(255,255,255,.22),
                  inset 0 -10px 14px rgba(0,0,0,.25),
                  0 10px 18px rgba(0,0,0,.35);
    }

    .disc.red{ background: radial-gradient(circle at 30% 28%, #fff3, transparent 35%),
                        radial-gradient(circle at 55% 55%, #ff8aa0, #ff4a6b 60%, #c20f32); }
    .disc.yellow{ background: radial-gradient(circle at 30% 28%, #fff4, transparent 35%),
                           radial-gradient(circle at 55% 55%, #fff0a8, #ffd24a 60%, #c79300); }

    .win{
      outline: 3px solid rgba(255,255,255,.18);
      box-shadow: 0 0 0 3px rgba(255,255,255,.06), 0 0 30px rgba(255,255,255,.18);
    }

    @keyframes drop{ to { transform: translateY(0); } }

    .side{
      background: linear-gradient(180deg, #0f1738, #0b1020);
      border: 1px solid #22306a;
      border-radius:18px;
      box-shadow: var(--shadow);
      padding:14px;
    }
    .card{
      border: 1px solid #22306a;
      border-radius:16px;
      padding:12px;
      background: #10184188;
    }
    .row{display:flex; align-items:center; justify-content:space-between; gap:10px;}
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid #2b3a77;
      background:#0f1738;
      font-weight:700;
      font-size:13px;
    }
    .dot{width:12px; height:12px; border-radius:999px;}
    .dot.red{background:var(--red)}
    .dot.yellow{background:var(--yellow)}

    .status{
      margin-top:10px;
      font-size:15px;
      line-height:1.4;
    }
    .status strong{font-weight:800}
    .muted{color:var(--muted); font-size:13px; line-height:1.5}

    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      border: 1px solid #2b3a77;
      padding: 2px 6px;
      border-radius: 8px;
      background: #0f1738;
      color: #d8defc;
    }

    .footer{
      color:var(--muted);
      font-size:12px;
      text-align:center;
      padding:6px 0 0;
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Connect 4">
    <header>
      <div>
        <h1>Connect 4</h1>
        <div class="sub">Two-player local game â€¢ Click a column or use <span class="kbd">1</span>â€“<span class="kbd">7</span> to drop a disc</div>
      </div>
      <div class="controls">
        <label class="toggle" title="If enabled, the game will highlight the winning four discs.">
          <input id="highlightWins" type="checkbox" checked />
          Highlight wins
        </label>
        <button id="newGameBtn" type="button">New game</button>
        <button id="undoBtn" type="button">Undo</button>
      </div>
    </header>

    <div class="main">
      <section class="board-wrap">
        <div class="drop-row" id="dropRow" aria-label="Drop discs"></div>
        <div class="grid" id="grid" aria-label="Board grid"></div>
      </section>

      <aside class="side" aria-label="Game info">
        <div class="card">
          <div class="row">
            <div class="pill"><span class="dot red"></span>Player 1</div>
            <div class="pill"><span class="dot yellow"></span>Player 2</div>
          </div>
          <div class="status" id="status"></div>
          <div class="muted" style="margin-top:10px;">
            Rules: first to connect <strong>4</strong> in a row (horizontal, vertical, diagonal) wins.
            <br/>Tip: Press <span class="kbd">U</span> to undo.
          </div>
        </div>

        <div class="card" style="margin-top:12px;">
          <div class="row" style="align-items:flex-start;">
            <div>
              <div style="font-weight:800; margin-bottom:6px;">Score</div>
              <div class="muted">Persists in this browser.</div>
            </div>
            <button id="resetScoreBtn" type="button" title="Reset score counters">Reset</button>
          </div>
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:12px;">
            <div class="pill" style="justify-content:center;"><span class="dot red"></span><span id="scoreRed">0</span></div>
            <div class="pill" style="justify-content:center;"><span class="dot yellow"></span><span id="scoreYellow">0</span></div>
          </div>
        </div>
      </aside>
    </div>

    <div class="footer">Made as a single-file site (HTML/CSS/JS). Save as <span class="kbd">index.html</span> and open it.</div>
  </div>

<script>
(() => {
  const COLS = 7;
  const ROWS = 6;
  const EMPTY = 0;
  const RED = 1;
  const YELLOW = 2;

  const gridEl = document.getElementById('grid');
  const dropRowEl = document.getElementById('dropRow');
  const statusEl = document.getElementById('status');
  const newGameBtn = document.getElementById('newGameBtn');
  const undoBtn = document.getElementById('undoBtn');
  const highlightWinsEl = document.getElementById('highlightWins');
  const scoreRedEl = document.getElementById('scoreRed');
  const scoreYellowEl = document.getElementById('scoreYellow');
  const resetScoreBtn = document.getElementById('resetScoreBtn');

  /** Board state: board[row][col] with row 0 at top */
  let board = Array.from({ length: ROWS }, () => Array(COLS).fill(EMPTY));
  let currentPlayer = RED;
  let gameOver = false;
  let winningCells = [];
  let moveHistory = []; // stack of {row, col, player}

  const SCORE_KEY = 'connect4_score_v1';
  let score = { red: 0, yellow: 0 };

  function loadScore() {
    try {
      const raw = localStorage.getItem(SCORE_KEY);
      if (raw) {
        const parsed = JSON.parse(raw);
        if (typeof parsed?.red === 'number' && typeof parsed?.yellow === 'number') {
          score = { red: parsed.red, yellow: parsed.yellow };
        }
      }
    } catch (_) {}
    renderScore();
  }

  function saveScore() {
    try { localStorage.setItem(SCORE_KEY, JSON.stringify(score)); } catch (_) {}
  }

  function renderScore() {
    scoreRedEl.textContent = String(score.red);
    scoreYellowEl.textContent = String(score.yellow);
  }

  function resetScore() {
    score = { red: 0, yellow: 0 };
    saveScore();
    renderScore();
  }

  function playerName(p) {
    return p === RED ? 'Player 1 (Red)' : 'Player 2 (Yellow)';
  }

  function discClass(p) {
    return p === RED ? 'red' : 'yellow';
  }

  function createUI() {
    // Drop buttons
    dropRowEl.innerHTML = '';
    for (let c = 0; c < COLS; c++) {
      const btn = document.createElement('button');
      btn.className = 'drop';
      btn.type = 'button';
      btn.setAttribute('aria-label', `Drop in column ${c + 1}`);
      btn.dataset.col = String(c);

      const preview = document.createElement('div');
      preview.className = 'preview';
      btn.appendChild(preview);

      btn.addEventListener('click', () => tryMove(c));
      dropRowEl.appendChild(btn);
    }

    // Cells
    gridEl.innerHTML = '';
    for (let r = 0; r < ROWS; r++) {
      for (let c = 0; c < COLS; c++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.dataset.row = String(r);
        cell.dataset.col = String(c);
        gridEl.appendChild(cell);
      }
    }
  }

  function setStatus(html) {
    statusEl.innerHTML = html;
  }

  function updateDropPreviews() {
    const drops = dropRowEl.querySelectorAll('.drop');
    drops.forEach((btn) => {
      const c = Number(btn.dataset.col);
      btn.disabled = gameOver || isColumnFull(c);
      const preview = btn.querySelector('.preview');
      if (!preview) return;
      preview.style.background = gameOver ? 'transparent' : (currentPlayer === RED ? 'var(--red)' : 'var(--yellow)');
      preview.style.boxShadow = gameOver ? 'none' : 'inset 0 10px 14px rgba(255,255,255,.22), inset 0 -10px 14px rgba(0,0,0,.25)';
    });
  }

  function isColumnFull(col) {
    return board[0][col] !== EMPTY;
  }

  function findOpenRow(col) {
    for (let r = ROWS - 1; r >= 0; r--) {
      if (board[r][col] === EMPTY) return r;
    }
    return -1;
  }

  function tryMove(col) {
    if (gameOver) return;
    const row = findOpenRow(col);
    if (row === -1) return;

    placeDisc(row, col, currentPlayer);
    moveHistory.push({ row, col, player: currentPlayer });

    const win = checkWin(row, col, currentPlayer);
    if (win) {
      gameOver = true;
      winningCells = win;
      if (currentPlayer === RED) score.red++; else score.yellow++;
      saveScore();
      renderScore();
      renderBoard();
      setStatus(`<strong>${playerName(currentPlayer)}</strong> wins! ðŸŽ‰`);
      updateDropPreviews();
      return;
    }

    if (isBoardFull()) {
      gameOver = true;
      winningCells = [];
      renderBoard();
      setStatus(`It's a <strong>draw</strong>.`);
      updateDropPreviews();
      return;
    }

    currentPlayer = (currentPlayer === RED) ? YELLOW : RED;
    renderBoard();
    setStatus(`Turn: <strong>${playerName(currentPlayer)}</strong>`);
    updateDropPreviews();
  }

  function placeDisc(row, col, player) {
    board[row][col] = player;
  }

  function clearCellHighlights() {
    gridEl.querySelectorAll('.cell.win').forEach(el => el.classList.remove('win'));
  }

  function renderBoard() {
    clearCellHighlights();

    // Clear any existing discs first (keeps drop animation on new discs only)
    gridEl.querySelectorAll('.disc').forEach(d => d.remove());

    for (let r = 0; r < ROWS; r++) {
      for (let c = 0; c < COLS; c++) {
        const v = board[r][c];
        if (v === EMPTY) continue;
        const cell = gridEl.querySelector(`.cell[data-row="${r}"][data-col="${c}"]`);
        if (!cell) continue;
        const disc = document.createElement('div');
        disc.className = `disc ${discClass(v)}`;
        cell.appendChild(disc);
      }
    }

    if (highlightWinsEl.checked && winningCells.length) {
      for (const { r, c } of winningCells) {
        const cell = gridEl.querySelector(`.cell[data-row="${r}"][data-col="${c}"]`);
        if (cell) cell.classList.add('win');
      }
    }

    undoBtn.disabled = moveHistory.length === 0;
  }

  function isBoardFull() {
    for (let c = 0; c < COLS; c++) {
      if (board[0][c] === EMPTY) return false;
    }
    return true;
  }

  function checkWin(lastRow, lastCol, player) {
    // Return the winning 4 cells [{r,c},...] or null
    const dirs = [
      { dr: 0, dc: 1 },  // horizontal
      { dr: 1, dc: 0 },  // vertical
      { dr: 1, dc: 1 },  // diag down-right
      { dr: 1, dc: -1 }, // diag down-left
    ];

    for (const { dr, dc } of dirs) {
      const line = [{ r: lastRow, c: lastCol }];

      // forward
      let r = lastRow + dr, c = lastCol + dc;
      while (inBounds(r, c) && board[r][c] === player) {
        line.push({ r, c });
        r += dr; c += dc;
      }

      // backward
      r = lastRow - dr; c = lastCol - dc;
      while (inBounds(r, c) && board[r][c] === player) {
        line.unshift({ r, c });
        r -= dr; c -= dc;
      }

      if (line.length >= 4) {
        // Pick the first 4-in-a-row segment that includes the last move (best-looking highlight)
        // We'll scan segments of length 4 and prefer one containing last cell.
        for (let i = 0; i <= line.length - 4; i++) {
          const seg = line.slice(i, i + 4);
          if (seg.some(p => p.r === lastRow && p.c === lastCol)) {
            return seg;
          }
        }
        return line.slice(0, 4);
      }
    }

    return null;
  }

  function inBounds(r, c) {
    return r >= 0 && r < ROWS && c >= 0 && c < COLS;
  }

  function newGame() {
    board = Array.from({ length: ROWS }, () => Array(COLS).fill(EMPTY));
    currentPlayer = RED;
    gameOver = false;
    winningCells = [];
    moveHistory = [];
    renderBoard();
    setStatus(`Turn: <strong>${playerName(currentPlayer)}</strong>`);
    updateDropPreviews();
  }

  function undo() {
    if (moveHistory.length === 0) return;

    // If game was over, undo should resume play
    gameOver = false;
    winningCells = [];

    const last = moveHistory.pop();
    if (!last) return;
    board[last.row][last.col] = EMPTY;
    currentPlayer = last.player; // back to the player who made the undone move

    renderBoard();
    setStatus(`Turn: <strong>${playerName(currentPlayer)}</strong>`);
    updateDropPreviews();
  }

  function handleKey(e) {
    if (e.repeat) return;

    // 1-7 to drop
    const k = e.key;
    if (k >= '1' && k <= '7') {
      const col = Number(k) - 1;
      tryMove(col);
      return;
    }

    if (k === 'u' || k === 'U') undo();
    if (k === 'n' || k === 'N') newGame();
  }

  // Wire up
  createUI();
  loadScore();
  newGameBtn.addEventListener('click', newGame);
  undoBtn.addEventListener('click', undo);
  highlightWinsEl.addEventListener('change', renderBoard);
  resetScoreBtn.addEventListener('click', resetScore);
  window.addEventListener('keydown', handleKey);
})();
</script>
</body>
</html>
